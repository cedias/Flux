function Flux(args){this.streams=[];this.tracksLoaded=0;this.currentStream=0;this.errorStreamsIndex=[];this.soundcloud_client_id=args.SCid;this.totalStreams=args.links.length;this.autoplay=args.autoplay;this.autostart=args.autostart;this.repeat=args.repeat;this.debug=args.debug;this.onfinish=args.onfinish;this._linksToStreams(args.links)}Flux.prototype._linksToStreams=function(list){for(var i=0;i<list.length;i++){var stream=this._newStreamFromLink(list[i],i);this.streams.push(stream)}};Flux.prototype._newStreamFromLink=function(link,index){SC.initialize({client_id:this.soundcloud_client_id});var args={flux:this,url:link,index:index};return new Stream_Soundcloud(args)};Flux.prototype._eventManager=function(evt){if(evt.msg==="Loaded"){this.tracksLoaded++;if(evt.index===0&&this.autostart)this.togglePlay()}if(evt.msg==="Song Ended"){if(this.currentStream===this.totalStreams-1&&this.repeat){this.next()}else if(this.currentStream!==this.totalStreams-1&&this.autoplay){this.next()}if(this.onfinish!=undefined)this.onfinish()}if(evt.msg==="Error"){this.errorStreamsIndex.push(evt.index);console.log("Error on Stream index "+evt.index+":"+evt.err_msg)}};Flux.prototype.stop=function(){if(this.streams[this.currentStream].streamable){this.streams[this.currentStream].stop();this.streams[this.currentStream].setPosition(0)}};Flux.prototype.togglePlay=function(){if(this.debug)console.log("toggling_play index: "+this.currentStream);if(!this.streams[this.currentStream].streamable)this.currentStream=(this.currentStream+1)%this.totalStreams;this.streams[this.currentStream].togglePlay();console.log("play:"+this.currentStream)};Flux.prototype.setVolume=function(volume){if(volume>=0&&volume<=100)this.streams[this.currentStream].setVolume(volume);else console.log("Error: volume [0;100] you gave "+volume)};Flux.prototype.getVolume=function(){return this.streams[this.currentStream].getVolume()};Flux.prototype.setPosition=function(time){this.streams[this.currentStream].setPosition(time)};Flux.prototype.getPosition=function(){return this.streams[this.currentStream].getPosition()};Flux.prototype.getLength=function(){return this.streams[this.currentStream].getLength()};Flux.prototype.getState=function(index){return this.streams[index].state};Flux.prototype.getStreamType=function(index){return this.streams[index].stream_type};Flux.prototype.isStreamable=function(index){return this.streams[index].streamable};Flux.prototype.next=function(){this.stop();this.currentStream=(this.currentStream+1)%this.totalStreams;if(this.autoplay)this.togglePlay();return this.currentStream};Flux.prototype.previous=function(){this.stop();if(this.currentStream!==0)this.currentStream--;else this.currentStream=this.totalStreams-1;if(this.autoplay)this.togglePlay();return this.currentStream};Flux.prototype.selectStream=function(song){if(this.streams[this.currentStream].streamable){this.stop();if(song>=0&&song<=this.totalStreams-1)this.currentStream=song;else console.log("Error: wrong song number");if(this.autoplay)this.togglePlay();return true}return false};Flux.prototype.getErrorStreams=function(){return this.errorStreamsIndex};Flux.prototype.addStream=function(link){var stream=this._newStreamFromLink(link,this.streams.length);this.streams.push(stream);this.totalStreams++};Flux.prototype.removeStream=function(index){if(index===this.currentStream)this.stop();this.streams.splice(index,1);this.totalStreams--;if(this.currentStream>index)this.currentStream--};function Stream_Soundcloud(args){this.flux=args.flux;this.stream_type="Soundcloud";this.state="created";this.streamable=false;this.client_id=args.flux.soundcloud_client_id;this.url=args.url;this.index=args.index;this.player=undefined;this._trackToStream(this.url)}Stream_Soundcloud.prototype._trackToStream=function(url){var self=this;var params={onfinish:function(){self.flux._eventManager({msg:"Song Ended",index:self.index})}};SC.get("http://api.soundcloud.com/resolve",{url:url},function(track){self.streamable=track.streamable;if(track.errors===undefined&&track.kind==="track"&&track.streamable){SC.stream("/tracks/"+track.id,params,function(sound){self.player=sound;self.state="loaded";self.flux._eventManager({msg:"Loaded",index:self.index})})}else{self.state="error";if(!self.streamable)self.flux._eventManager({msg:"Error",index:self.index,err_msg:"SC Link not streamable"});else self.flux._eventManager({msg:"Error",index:self.index,err_msg:"Wrong SC Link"})}})};Stream_Soundcloud.prototype.stop=function(){this.player.stop();this.player.setPosition(0)};Stream_Soundcloud.prototype.togglePlay=function(){this.player.togglePause()};Stream_Soundcloud.prototype.setVolume=function(volume){if(volume>=0&&volume<=100)this.player.setVolume(volume);else console.log("Error: volume [0;100] you gave "+volume);return this.player.volume};Stream_Soundcloud.prototype.getVolume=function(){return this.player.volume};Stream_Soundcloud.prototype.setPosition=function(time){this.player.setPosition(time*1e3);return this.player.position};Stream_Soundcloud.prototype.getPosition=function(){return this.player.position};Stream_Soundcloud.prototype.getLength=function(){return this.player.duration};